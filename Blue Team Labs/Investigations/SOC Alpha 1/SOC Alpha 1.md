# Scenario

You are a SOC analyst and handling the alerts within your SIEM, ELK, is part of daily duties. Answer the following questions by analysing the alerts provided in README.txt!  
  
ELK should start within 5 minutes, if not please try to start the services manually :  
sudo systemctl start elasticsearch  
sudo systemctl start kibana  
sudo systemctl start logstash  
_(this is temporary)_

# Used Tools

- **ELK:** The ElasticStack is an open-source collection of softwares made by Elastic (Elasticsearch/Kibana/Logstash). These can be combined to create many functions and even SIEM environment, which is used in this investigation.

# Alerts

## Alert 1

![[Alert1.png]]

## Alert 2

![[Alert2.png]]

## Alert 3

![[Alert3.png]]

## Alert 4

![[Alert4.png]]

# Questions

For every alert we need to filter in Kibana by the Alert TimeFrame given in each.

## Alert 1 (1/2) - What is the cmdlet used for downloading?

A cmdlet, short for "command-let," is a command used in various Microsoft operating systems and software applications. Cmdlets are a type of command used in the Windows PowerShell framework, a task automation and configuration management framework developed by Microsoft.

By searching online, I have seen that the Powershell cmdlet used to download is **Invoke-WebRequest**.

## Alert 1 (2/2) - What is the full URL from which the file is downloaded?

So, we will have to search Powershell commands in the **winevent-Powershell** index that use the Invoke-WebRequest cmdlet. After filtering by the index and the TimeFrame we must use CTRL+F, to find the events that have Invoke-WebRequest in the CommandLine= argument. 

We will find 6 matches, but only one of them contains the -Uri flag with an URL. So the answer is: **hxxps://raw.githubusercontent[.]com/nerrorsec/SBT-SOC/main/MSWorker.exe**

![[Alert1_URL.png]]

The answer has been sanitized to avoid any missclick.

## Alert 2 (1/1) - What is the name of the suspicious EXE that is added for Persistence?

For finding this answer we need to change to the sysmon index and update the TimeFrame. In here we can find the answer by executing **CTRL+F** by the string **.exe**. In addition, in the past question we got the name of the suspicious file, so as we can see the same file was added into the AppData\Roaming path.

![[Alert2_File.png]]

This is a path used for persistence because its data is executed automatically during user login or system startup and security software might be less likely to flag or block executables in this location since this directory is full of User-specific data.

## Alert 3 (1/2) - What is the name of the suspicious executable file involved?

The rule that created the alert is a conditional AND made up by Event_System_EventID and Event_EventData_TargetObject. So we have to filter all the events that have the Event_EventData_TargetObject value not empty, this way we obtain 24 hits. With this filter we can appreciate that only 3 executables are being involved, which are svchost.exe/services.exe/reg.exe. 

- **svchost.exe:** It's used to host and run multiple Windows services as separate, shared processes. 
- **services.exe** This process initializes, starts, and stops services based on the configuration and dependencies defined in the Windows Registry.
- **reg.exe:** Allows you to interact with and manipulate the Windows Registry.

So we go back to remove the filters and we will see that in the first records during that FrameTime, the followinng event was recorded:

![[Alert3_Register.png]]

This event shows that a registry was added in the Run path by **services.exe**

## Alert 3 (2/2) - What is the name of the key path?

The name of the Registry Path a s can be seen in the past image is: HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Service, so the Key Path is **Service**. 

This registry path is a specific location in the Windows Registry where startup programs and applications are configured to run automatically when a particular user logs into their account. So the malware was creating persistence. 

## Alert 4 (1/2) - What is the name of the task?

For this last alert we adjust again the TimeFrame and we will see some events. As wee can see in the Alert File, it was generated by a Event_EventData_Image= svctasks.exe

So we only have to filter by that obtaining only one hit. We inspect the following event and we can see that the name of the task is **My Task**.

![[Alert4_Task.png]]
## Alert 4 (2/2) - What is the full path of the program?

As we can see in the previous Image the full path of the program is **C:\\Program Files\\GameLoaderGen\gen.bat**.

So this task will execute this program every day as we can see in the commandline. 